---
layout: post
title: "[NextCafe] 댓글에 대한 고민"
date: 2024-02-02 23:14:00 +0900
categories: project
---

댓글을 구현하는데 당연히 Pagination을 했을것이라고 생각했었는데, URL을 보니까 List를 한번에 불러온 뒤 HTML 태그 기능(#)을 사용한 것 같았다. 댓글 페이지네이션을 `href="#"` 를 사용해 프론트에서 구현한 것 같았다. 처음에는 ~~레거시 코드인가..?~~ 의아하게 생각했는데 구현을 해보면서 이유를 추측해볼수 있었다.

댓글 기능은 댓글-대댓글로 이루어져있기 때문에, 댓글 다음에 대댓글이 출력되도록 하려면 트리 구조를 이용해야 한다.
예전에 오라클에서 `CONNECT BY`를 사용해 native query를 작성하고 Page객체를 return 하는 기능을 만들었었기 때문에, Mysql에서도 비슷하게 구현하려고 했다. Mysql같은 경우는 트리 구조를 조회하기 위해 `WITH RECURSIVE`을 사용해 가상 트리를 생성한 다음에 그 트리를 select 한다. 하지만 JPA Hibernate에서는 가상 트리를 읽어올 수 없기 때문에 오류가 발생했다. (CTM을 사용할 수 있게 해주는 다른 라이브러리를 사용하면 해결할 수 있다.) 결국에는 JPA만으로는 Mysql에서 트리구조를 출력하는 것은 불가능하기 때문에, service단에서 댓글과 대댓글을 조립하기로 했다.

물론 쿼리로 만들어오는게 가장 효율적이겠지만 serivce 단에서의 로직을 고려해 볼 만한 몇 가지 이유가 있었다.

- 한 post에 댓글은 9999개까지만 작성된다 : 댓글이 어어엄청 많지 않기 때문에 충분히 service에서 처리할 수 있다.
- 댓글은 페이지 이동이 빈번해 항상 api를 쏘는 것이 경제적이지 않을수도 있다. 또 모바일앱에서는 인피티니 스크롤로 구현되어있어서 api에서 한 번에 데이터를 넘겨주면, 프론트에서 웹과 앱에서 적절하게 구현하는 것이 방법이 될 수도 있겠다.

다음카페는 JPA로 구현되어있지 않을수도 있고 페이지네이션을 적용하지 않은 다른 이유가 있을수도 있지만 service단에서 구현해보도록 한다.
